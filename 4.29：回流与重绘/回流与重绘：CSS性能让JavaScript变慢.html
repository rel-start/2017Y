<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
<!-- [http://www.zhangxinxu.com/wordpress/2010/01/%E5%9B%9E%E6%B5%81%E4%B8%8E%E9%87%8D%E7%BB%98%EF%BC%9Acss%E6%80%A7%E8%83%BD%E8%AE%A9javascript%E5%8F%98%E6%85%A2%EF%BC%9F/]
	
	当一个元素的外观的可见性visibility发生改变的时候, 重绘(repaint)也随之发生, 但是不影响布局. 类似的例子包括: outline, visibility, background color. 根据Opera浏览器, 重绘的代价是高昂的, 因为浏览器必须验证DOM树上其他节点元素的可见性. 而回流更是性能的关键因为其变化涉及到部分页面(或是整个页面)的布局. 一个元素的回流导致了其所有子元素以及DOM中紧随其后的祖先元素的随后的回流。

	例如:
	<body>
	<div class="error">
		<h4>我的组件</h4>
		<p><strong>错误:</strong>错误的描述...</p>
		<h5>错误纠正</h5>
		<ol>
			<li>第一步</li>
			<li>第二步</li>
		</ol>
	</div>
	</body>
	在上面的HTML片段中, 对该段落(<p>标签)回流将会引发强烈的回流, 因为它是一个子节点. 这也导致了祖先的回流(div.error和body-视浏览器而定). 此外, h5和ol也会有简单的回流, 因为其在DOM中在回流元素之后. 就Opera而言, 大部分的回流将导致页面的重新渲染。
	Opera原文: 在性能方面, 回流是非常昂贵的, 并且是一个缓慢的DOM脚本的主要原因, 特别是在处理能力较低的设备, 如手机. 在很多情况下, 它们相当于重新布局整个页面。

	一、既然它们对性能影响如此可怕, 那什么会导致回流呢?
		不幸的是, 很多的东西, 其中一些还与CSS的书写特别相关。
		1.调整窗口大小
		2.改变字体
		3.增加或者移除样式表
		4.内容变化, 比如用户在input框中输入文字
		5.激活CSS伪类, 比如:hover(IE中为兄弟节点伪类的激活)
		6.操作class属性
		7.脚本操作DOM
		8.计算offsetWidth和offsetHeight属性
		9.设置style属性的值
		Mozilla关于回流的文章[网址404]罗列了导致回流的要点以及何时可以减少他们。

	二、如何避免回流或将它们对性能的影响降到最低?
		注意：这里我限定了自己只能讨论CSS对回流的影响，如果您是一位JavaScript程序员，我是推荐您读一下我的reflow链接[http://www.zhangxinxu.com/wordpress/2009/10/attention-reflow-to-make-web-faster/]

		1.如果想设定元素的样式, 通过改变元素的class名(尽可能在DOM树的最末端)
		2.避免设置多项内联样式
		3.应用元素的动画, 使用position属性的fixed值或absolute值
		4.权衡平滑和速度
		5.避免使用table布局
		6.避免使用CSS的JavaScript表达式(仅IE浏览器)

		㈠ 尽可能在DOM树的最末端改变class
		回流可以自上而下, 或自下而上的回流的信息传递给周围的节点. 回流是不可避免的, 但可以减少其影响. 尽可能在DOM树的里面改变class, 可以限制了回流的范围, 是其影响尽可能少的节点. 例如, 你应该避免通过改变对包装元素类去影响子节点的显示. 面向对象的CSS始终尝试获得它们影响的类对象(DOM节点或节点), 但在这种情况下, 它已尽可能的减少了回流的影响, 增加性能优势。

		㈡ 避免设置多层内联样式
		我们都知道与DOM交互很慢. 我们尝试在一种无形的DOM树片段组进行更改, 然后整个改变应用到DOM上时仅导致了一个回流. 同时, 通过style属性设置样式导致回流. 避免设置多级内联样式, 因为每个都会造成回流, 样式应该合并在一个外部类, 这样当该元素的class属性可被操控时仅会产生一个reflow。

		㈢ 动画效果应用到position属性为absolute或fixed的元素上
		动画效果应用到position属性为absolute或fixed的元素上, 它们不影响其他元素的布局, 所以它们只会导致重新绘制, 而不是一个完整回流. 这样消耗会更低。

		㈣ 牺牲平滑度换区速度
		Opera还建议我们牺牲平滑度, 其意思是指您可能想每次1px移动一个动画, 但是如果此动画及随后的回流使用了100%的CPU, 动画就会看上去是跳动的, 因为浏览器正在与更新回流做斗争. 动画元素每次移动3px可能在非常快的机器上看起来平滑度低了, 但它不会导致CPU在较慢的机器和移动设备中抖动。

		㈤ 避免使用table布局
		避免使用table布局. 可能您需要其他鞋避免使用table的理由, 在布局完全建立之前, table经常需要多个关口, 因为table是个和罕见的可以影响在它们之前已经进入的DOM元素的显示的元素. 想象以下, 因为表格最后一个单元格的内容过宽而导致纵列大小完全改变. 这就是为什么所有的浏览器都逐步地不支持table表格的渲染（感谢Bill Scott提供）. 然而有另外一个原因为什么表格布局时很糟糕的主意, 根据Mozilla, 即时一些小的变化将导致table中的所有其他节点回流。

		Jenny Donnelly, YUI 数据表格 widget的所有者, 建议使用数据表格的股东布局以便更有效的布局算法, 任何表格-布局的值除了'auto'将引发一个固定布局，根据CSS2.1规范，这将允许表格一行一行的呈递。Quirksmode显示，大部分的浏览器对表格布局属性支持良好。
		固定布局, CSS 2.1 规范[https://www.w3.org/TR/CSS21/tables.html#fixed-table-layout]
		自动布局, CSS 2.1 规范[https://www.w3.org/TR/CSS21/tables.html#auto-table-layout]

		㈥ 避免使用CSS的JavaScript表达式
		这项规则较过时，但确实是个好的主意。主要的原因，这些表现是如此昂贵，是因为他们每次重新计算文档，或部分文档、回流。正如我们从所有的很多事情看到的：引发回流，它可以每秒产生成千上万次。当心！

	三、进一步的学习
		Yahoo! 出色的性能团队做了一个实验, 以确定最佳的方法引入外部的样式表文件. 我们建议把链接标记放在头部, 尽管其比所有其他阻碍进一步渲染的方法慢一秒(6.3至7.3秒). 虽然逐步地渲染不可改变的(用户讨厌盯着一个空白屏幕), 但它使我对下载组件和整个响应时间的渲染, 重画, 回流和CPU的颠簸造成的影响感到好奇. 如果我们可以减少加载过程中的回流个数我们可以夺回了失去的时间的十分之一(100毫秒)吗? 如果它是多达一半呢？

		在SXSW我试图说服史蒂夫的回流是很重要的. 我告诉他一个我已经做了很长一段时间的实验, 指示没有时间. 我希望有人能在我留下来的那个地方继续(提示! 提示!). 虽然加载页面我想故意引发不同程度的回流. 这或许可以通过切换一个body(实验)标签的class名称来改变body的最后一个child(没有子节点)完成. 比较这两者情况, 并增加每秒回流的数目, 我们可以关联回流反应时间. 衡量JS反应对回流的影响将会更难, 因为我们所做能够引发回流的事情都可能会影响实验. 

		最后，量化影响的趣味只有那么一点点，因为浏览器厂商会告诉我们它的问题。或许更有趣的是把注意力集中在回流的原因以及如何避免它们。这将需要更好的工具，所以我需要浏览器厂商和性能社区共同努力，使之成为现实！

	四、回流消失的疯狂
		为了改进性能, 浏览器厂商可能限制回流影响临近的节点或者联合其他几个回流形成一次大的改变, 就如Mozilla的这篇文章[http://www.mozilla.org/newlayout/doc/reflow.html] 中展示的. 这可以提高性能, 但有时也可能导致心事问题. 您可以使用我们所了解到的关于回流的指示, 在必要纠正相关显示问题的时候触发它们。

		例如, 我们改变图片优化网站上的选项卡, [http://www.smushit.com/], 随着选项卡的不同, 内容区域的高度是不断变化的, 有时候, 下面的投影会被留下, 这是因为内容区域上的父节点被切换而其容器可能没有回流, 下面这张图是模拟的, 因为这个bug很难用相机捕捉, 任何试图获取操作都会导致回流而纠正显示. 如果你自己发现类似的bug, 移动背景图片到下面切花的DOM元素上。

		另外一个例子是动态添加列表项, 当您将列表项从9个增加到10个或是从99个增加到100个, 列表的数字将不会正确的排队显示, 这在所有浏览器都是. 当总数按数量的排序增加且浏览器不回流兄弟节点是, 队列被打破. 快速切换整个列表的系那是或是增加添加一个class类, 即时没有相关联的样式, 也会导致回流和正确的队列显示。
	【图片1】
-->

</body>
</html>